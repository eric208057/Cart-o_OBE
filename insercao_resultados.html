<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Relatório POP - Policiamento Ostensivo a Pé</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { padding: 20px; background: #f8f9fa; }
    .section { background: white; padding: 20px; margin-bottom: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    table { font-size: 0.9rem; }
    th { background: #e9ecef; }
  </style>
</head>
<body>
  <div class="container">
    <h2 class="text-center mb-4">POLÍCIA MILITAR DO ESTADO DE SÃO PAULO<br>ESCOLA SUPERIOR DE SARGENTOS<br>POLICIAMENTO OSTENSIVO A PÉ</h2>

    <form id="popForm" action="https://script.google.com/macros/s/AKfycbwYBg6B9PQJfMlHxJ2npam3JNE9Q8RV0aLb-SH1GIhbfCv8l5tX4SbPW-Ly66MV2py-/exec" method="POST">

      <div class="section">
        <div class="row">
          <div class="col-md-6 mb-3">
            <label class="form-label">OPERAÇÃO:</label>
            <input type="text" class="form-control" name="operacao" required>
          </div>
          <div class="col-md-6 mb-3">
            <label class="form-label">OPM ATUAÇÃO:</label>
            <input type="text" class="form-control" name="opm">
          </div>
        </div>

        <div class="row">
          <div class="col-md-4 mb-3">
            <label class="form-label">LOCAL:</label>
            <input type="text" class="form-control" name="local" required>
          </div>
          <div class="col-md-4 mb-3">
            <label class="form-label">DATA:</label>
            <input type="date" class="form-control" name="data" required>
          </div>
          <div class="col-md-4 mb-3">
            <label class="form-label">TURNO:</label>
            <div class="input-group">
              <input type="text" class="form-control" placeholder="das" name="turnoInicio">
              <span class="input-group-text">às</span>
              <input type="text" class="form-control" name="turnoFim">
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col-md-8 mb-3">
            <label class="form-label">Encarregado (Nome de Guerra):</label>
            <input type="text" class="form-control" name="encarregadoNome" required>
          </div>
          <div class="col-md-4 mb-3">
            <label class="form-label">RE:</label>
            <input type="text" class="form-control" name="encarregadoRE" required>
          </div>
        </div>
      </div>

      <!-- RONDAS -->
      <div class="section">
        <h4>RONDAS</h4>
        <table class="table table-bordered" id="tabelaRondas">
          <thead><tr><th>Horário</th><th>Post/Grad</th><th>RE</th><th>Nome de Guerra</th><th>Local</th><th></th></tr></thead>
          <tbody>
            <tr>
              <td><input type="text" class="form-control" name="rondaHorario[]"></td>
              <td><input type="text" class="form-control" name="rondaPostGrad[]"></td>
              <td><input type="text" class="form-control" name="rondaRE[]"></td>
              <td><input type="text" class="form-control" name="rondaNome[]"></td>
              <td><input type="text" class="form-control" name="rondaLocal[]"></td>
              <td><button type="button" class="btn btn-danger btn-sm remover">Remover</button></td>
            </tr>
          </tbody>
        </table>
        <button type="button" class="btn btn-secondary btn-sm" id="addRonda">Adicionar Ronda</button>
      </div>

      <!-- OCORRÊNCIAS ATENDIDAS -->
      <div class="section">
        <h4>OCORRÊNCIAS ATENDIDAS</h4>
        <table class="table table-bordered" id="tabelaOcorrencias">
          <thead><tr><th>Quant.</th><th>Horário Inicial</th><th>Local</th><th>Natureza</th><th>Horário Final</th><th></th></tr></thead>
          <tbody>
            <tr>
              <td><input type="number" class="form-control" name="ocorrenciaQuant[]"></td>
              <td><input type="text" class="form-control" name="ocorrenciaInicio[]"></td>
              <td><input type="text" class="form-control" name="ocorrenciaLocal[]"></td>
              <td><input type="text" class="form-control" name="ocorrenciaNatureza[]"></td>
              <td><input type="text" class="form-control" name="ocorrenciaFim[]"></td>
              <td><button type="button" class="btn btn-danger btn-sm remover">Remover</button></td>
            </tr>
          </tbody>
        </table>
        <button type="button" class="btn btn-secondary btn-sm" id="addOcorrencia">Adicionar Ocorrência</button>
      </div>

      <!-- PESSOAS ABORDADAS -->
      <div class="section">
        <h4>PESSOAS ABORDADAS</h4>
        <table class="table table-bordered" id="tabelaPessoas">
          <thead><tr><th>Quant.</th><th>Horário</th><th>Local</th><th>NOME</th><th>Nº DOC (RG/CPF)</th><th></th></tr></thead>
          <tbody>
            <tr>
              <td><input type="number" class="form-control" name="pessoaQuant[]"></td>
              <td><input type="text" class="form-control" name="pessoaHorario[]"></td>
              <td><input type="text" class="form-control" name="pessoaLocal[]"></td>
              <td><input type="text" class="form-control" name="pessoaNome[]"></td>
              <td><input type="text" class="form-control" name="pessoaDoc[]"></td>
              <td><button type="button" class="btn btn-danger btn-sm remover">Remover</button></td>
            </tr>
          </tbody>
        </table>
        <button type="button" class="btn btn-secondary btn-sm" id="addPessoa">Adicionar Pessoa</button>
      </div>

      <!-- VEÍCULOS FISCALIZADOS -->
      <div class="section">
        <h4>VEÍCULOS FISCALIZADOS</h4>
        <table class="table table-bordered" id="tabelaVeiculos">
          <thead><tr><th>Quant.</th><th>Horário</th><th>Placa</th><th>Modelo</th><th>Local</th><th></th></tr></thead>
          <tbody>
            <tr>
              <td><input type="number" class="form-control" name="veiculoQuant[]"></td>
              <td><input type="text" class="form-control" name="veiculoHorario[]"></td>
              <td><input type="text" class="form-control" name="veiculoPlaca[]"></td>
              <td><input type="text" class="form-control" name="veiculoModelo[]"></td>
              <td><input type="text" class="form-control" name="veiculoLocal[]"></td>
              <td><button type="button" class="btn btn-danger btn-sm remover">Remover</button></td>
            </tr>
          </tbody>
        </table>
        <button type="button" class="btn btn-secondary btn-sm" id="addVeiculo">Adicionar Veículo</button>
      </div>

      <div class="text-center mt-4">
        <button type="submit" class="btn btn-success btn-lg">ENVIAR RELATÓRIO</button>
      </div>
    </form>

    <div id="resultado" class="mt-4"></div>
  </div>

  <script>
    // Função para adicionar linha em tabela
    function addRow(tableId, template) {
      document.querySelector(`#${tableId} tbody`).insertAdjacentHTML('beforeend', template);
    }

    // Templates das linhas
    const rondaTemplate = `<tr>
      <td><input type="text" class="form-control" name="rondaHorario[]"></td>
      <td><input type="text" class="form-control" name="rondaPostGrad[]"></td>
      <td><input type="text" class="form-control" name="rondaRE[]"></td>
      <td><input type="text" class="form-control" name="rondaNome[]"></td>
      <td><input type="text" class="form-control" name="rondaLocal[]"></td>
      <td><button type="button" class="btn btn-danger btn-sm remover">Remover</button></td>
    </tr>`;

    const ocorrenciaTemplate = `<tr>
      <td><input type="number" class="form-control" name="ocorrenciaQuant[]"></td>
      <td><input type="text" class="form-control" name="ocorrenciaInicio[]"></td>
      <td><input type="text" class="form-control" name="ocorrenciaLocal[]"></td>
      <td><input type="text" class="form-control" name="ocorrenciaNatureza[]"></td>
      <td><input type="text" class="form-control" name="ocorrenciaFim[]"></td>
      <td><button type="button" class="btn btn-danger btn-sm remover">Remover</button></td>
    </tr>`;

    const pessoaTemplate = `<tr>
      <td><input type="number" class="form-control" name="pessoaQuant[]"></td>
      <td><input type="text" class="form-control" name="pessoaHorario[]"></td>
      <td><input type="text" class="form-control" name="pessoaLocal[]"></td>
      <td><input type="text" class="form-control" name="pessoaNome[]"></td>
      <td><input type="text" class="form-control" name="pessoaDoc[]"></td>
      <td><button type="button" class="btn btn-danger btn-sm remover">Remover</button></td>
    </tr>`;

    const veiculoTemplate = `<tr>
      <td><input type="number" class="form-control" name="veiculoQuant[]"></td>
      <td><input type="text" class="form-control" name="veiculoHorario[]"></td>
      <td><input type="text" class="form-control" name="veiculoPlaca[]"></td>
      <td><input type="text" class="form-control" name="veiculoModelo[]"></td>
      <td><input type="text" class="form-control" name="veiculoLocal[]"></td>
      <td><button type="button" class="btn btn-danger btn-sm remover">Remover</button></td>
    </tr>`;

    // Botões de adicionar
    document.getElementById('addRonda').addEventListener('click', () => addRow('tabelaRondas', rondaTemplate));
    document.getElementById('addOcorrencia').addEventListener('click', () => addRow('tabelaOcorrencias', ocorrenciaTemplate));
    document.getElementById('addPessoa').addEventListener('click', () => addRow('tabelaPessoas', pessoaTemplate));
    document.getElementById('addVeiculo').addEventListener('click', () => addRow('tabelaVeiculos', veiculoTemplate));

    // Remover linha (não permite remover a última)
    document.addEventListener('click', e => {
      if (e.target.classList.contains('remover')) {
        const tbody = e.target.closest('tbody');
        if (tbody.children.length > 1) {
          e.target.closest('tr').remove();
        }
      }
    });

    // Envio do formulário
    document.getElementById('popForm').addEventListener('submit', function(e) {
      e.preventDefault();

      const formData = new FormData(this);
      const resultado = document.getElementById('resultado');

      fetch(this.action, { method: 'POST', body: formData })
        .then(response => response.text())
        .then(msg => {
          resultado.innerHTML = `<div class="alert alert-success">${msg}</div>`;
          this.reset();
        })
        .catch(err => {
          resultado.innerHTML = `<div class="alert alert-danger">Erro ao enviar: ${err}</div>`;
          console.error(err);
        });
    });
  </script>
</body>
</html>